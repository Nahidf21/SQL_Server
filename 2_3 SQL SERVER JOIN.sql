CREATE DATABASE EMPLOYEES_MANAGEMENT_SYSTEM;
GO

CREATE TABLE LOCATION 
(
	LOCATION_ID INT PRIMARY KEY NOT NULL,
	REGIONAL_GROUP VARCHAR (50) 
);

INSERT INTO LOCATION VALUES (122,'NEW YORK');
INSERT INTO LOCATION VALUES (123,'DALLAS');
INSERT INTO LOCATION VALUES (124,'CHICAGO');
INSERT INTO LOCATION VALUES (167,'BOSTON');

CREATE TABLE JOB
(
	JOB_ID INT PRIMARY KEY NOT NULL,
	JOB_NAME VARCHAR (50) 
);


INSERT INTO JOB VALUES (667,'CLERK');
INSERT INTO JOB VALUES (669,'ANALYST');
INSERT INTO JOB VALUES (670,' SALESPERSON');
INSERT INTO JOB VALUES (671,'MANAGER');

CREATE TABLE DEPARTMENT 
(
	DEPARTMENT_ID INT PRIMARY KEY NOT NULL,
	NAME VARCHAR (20),
	LOCATION_ID INT NOT NULL,
	FOREIGN KEY (LOCATION_ID) REFERENCES LOCATION(LOCATION_ID)
);

INSERT INTO DEPARTMENT VALUES (10,'ACCOUNTING',122);
INSERT INTO DEPARTMENT VALUES (20,'RESEARCH',124);
INSERT INTO DEPARTMENT VALUES (30,'SALES',123);
INSERT INTO DEPARTMENT VALUES (40,'OPERATIONS',167);


CREATE TABLE EMPLOYEE 
(
EMPLOYEE_ID INT PRIMARY KEY NOT NULL,
LAST_NAME VARCHAR (20),
FIRST_NAME VARCHAR (20),
MIDDLE_NAME VARCHAR (20),
JOB_ID INT NOT NULL,
MANAGER_ID INT,
HIREDATE VARCHAR (15),
SALARY INT,
COMM INT,
DEPARTMENT_ID INT NOT NULL,
FOREIGN KEY (JOB_ID) REFERENCES JOB(JOB_ID),
FOREIGN KEY (DEPARTMENT_ID) REFERENCES DEPARTMENT(DEPARTMENT_ID)
);

INSERT INTO EMPLOYEE VALUES (7369,'SMITH','JOHN','Q',667,7902,'17-DEC-84',800,NULL,20);
INSERT INTO EMPLOYEE VALUES (7499,'ALLEN','KEVIN','J',670,7698,'20-FEB-85',1600,300,30);
INSERT INTO EMPLOYEE VALUES (7505,'DOYLE','JEAN','K',671,7839,'04-APR-85',2850,NULL,30);
INSERT INTO EMPLOYEE VALUES (7698,'DENNIS','LYNN','S',671,7839,'15-MAY-85',2750,NULL,30);
INSERT INTO EMPLOYEE VALUES (7839,'BAKER','LESLIE','D',671,7839,'10-JUN-85',2200,NULL,40);
INSERT INTO EMPLOYEE VALUES (7902,'WARK','CYNTHIA','D',670,7698,'22-FEB-85',1250,500,30);


SELECT
M.FIRST_NAME, M.MANAGER_ID , COUNT(E.EMPLOYEE_ID)
from 
EMPLOYEE AS  E INNER JOIN EMPLOYEE AS M  ON  E.EMPLOYEE_ID = M.MANAGER_ID 
GROUP BY M.MANAGER_ID,M.FIRST_NAME;

SELECT * FROM EMPLOYEE AS E;


SELECT
    M.MANAGER_ID, E.FIRST_NAME,
    COUNT(E.EMPLOYEE_ID) AS NUM_OF_EMPLOYEES
FROM 
    EMPLOYEE AS E 
    INNER JOIN EMPLOYEE AS M ON E.EMPLOYEE_ID = M.MANAGER_ID 
GROUP BY 
    M.MANAGER_ID, E.FIRST_NAME
ORDER BY NUM_OF_EMPLOYEES;


SELECT M.FIRST_NAME AS MGR, M.MANAGER_ID, COUNT(*) AS NUM_OF_EMPLOYEES
 
FROM EMPLOYEE E, EMPLOYEE M
 
WHERE E.MANAGER_ID = M.EMPLOYEE_ID
 
GROUP BY  M.FIRST_NAME,M.MANAGER_ID


select * from dbo.DEPARTMENT;
select * from dbo.EMPLOYEE;
SELECT * FROM DBO.JOB;
SELECT * FROM DBO.LOCATION;

SELECT * FROM DBO.JOB AS J
CROSS JOIN DBO.EMPLOYEE AS E;


SELECT * FROM DBO.DEPARTMENT AS D
FULL JOIN DBO.EMPLOYEE AS E
ON D.DEPARTMENT_ID = E.DEPARTMENT_ID;

SELECT * FROM DBO.DEPARTMENT AS D
INNER JOIN DBO.EMPLOYEE AS E
ON D.DEPARTMENT_ID = E.DEPARTMENT_ID;


SELECT * FROM DBO.DEPARTMENT AS D
LEFT JOIN DBO.EMPLOYEE AS E
ON D.DEPARTMENT_ID = E.DEPARTMENT_ID;


--- EXAM TEST 
--How many employees who are working in the SALES department. Show department name (Name) and the number of employees in the SALES department. Use the tables given below. (Note: Use Table and Column names in capital letters)

SELECT D.NAME, COUNT(E.EMPLOYEE_ID) NUMBER_OF_EMPLOYEES FROM 
DBO.DEPARTMENT AS D INNER JOIN DBO.EMPLOYEE AS E
ON D.DEPARTMENT_ID = E.DEPARTMENT_ID
WHERE D.NAME = 'SALES'
GROUP BY D.NAME;

-- Write a query to show the number of employees working under every manager with manager first name and manager ID. Use the tables given below. (Note: Use Table and Column names in capital letters)

SELECT E1.FIRST_NAME AS MANAGER_NAME, E2.MANAGER_ID , COUNT(E1.EMPLOYEE_ID) AS TOTAL_EMPLOYEE FROM 
DBO.EMPLOYEE E1 INNER JOIN DBO.EMPLOYEE E2
ON E1.EMPLOYEE_ID = E2.MANAGER_ID
GROUP BY E2.MANAGER_ID,E1.FIRST_NAME;




